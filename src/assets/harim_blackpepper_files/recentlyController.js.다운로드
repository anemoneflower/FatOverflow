define(["jquery","common/template/urlBuilder","../common/utils/recently-utility","common/essentialData"],function($,urlBuilder,utility,essentialData){var apiUrl=essentialData.getDataFodiumWebUrl()||"//reco.coupang.com";var recentlyController={ui:{item:".recently-viewed-item",recentlyViewedPage:".recently-viewed-page",prev:".recentlyViewedBtn .prev",next:".recentlyViewedBtn .next",pageNumber:".pageNumber",deleteItem:".recently-delete"},init:function(){utility.uiEnhancements.call(this);this.ui.prev.on("click",
$.proxy(this._movePrev,this));this.ui.next.on("click",$.proxy(this._moveNext,this));this.ui.recentlyViewedPage.eq(0).show();$.ajax({type:"GET",url:apiUrl+"/api/v2/viewed-products?page\x3d0",dataType:"jsonp",xhrFields:{withCredentials:true},success:function(data){recentlyController._render(data.data)},error:function(){data={totalElements:0,numberOfElements:0};recentlyController._render(data)}})},_render:function(data){var element=data.content,totalpages=data.totalPages,numberOfElements=data.numberOfElements,
totalElements=data.totalElements,pageNumber=data.number+1,$totalCnt=$(".total-element"),$totalPages=$(".total-pages"),$btnArea=$(".recentlyViewedBtn"),$page=$(".recent-viewed-paging"),recentlyViewedItem=".recently-viewed-item",recentlyDelete=".recently-delete",listhtml="";$totalCnt.empty().text(totalElements);if(pageNumber>0)$page.show();if(numberOfElements>0){for(var i=0;i<numberOfElements;i++){var title=element[i].title,id=element[i].productId,link=element[i].link,salesPrice=element[i].salesPrice,
src=element[i].thumbnailUrl;this.ui.recentlyViewedPage.empty();listhtml+='\x3cli class\x3d"recently-viewed-item"\x3e'+'\x3ca href\x3d"'+this.ui.recentlyViewedPage.data("href")+link+'" class\x3d"view-item" data-coulog\x3d\'{"logCategory":"event", "logType":"click", "logLabel":"recently_item_'+i+'","grp":"sideBar_recentlyItem"}\'\x3e'+'\x3cimg src\x3d"'+src+'" class\x3d"thumbnail" alt\x3d"" /\x3e'+'\x3cspan class\x3d"name"\x3e'+title+"\x3c/span\x3e"+'\x3cspan class\x3d"price"\x3e\x3cem class\x3d"sales-price"\x3e'+
utility.price.addComma(salesPrice)+"\x3c/em\x3e원\x3c/span\x3e"+"\x3c/a\x3e"+'\x3ca href\x3d"삭제" class\x3d"recently-delete" title\x3d"닫기" data-productid\x3d"'+id+'"\x3e\x3c/a\x3e'+"\x3c/li\x3e";this.ui.recentlyViewedPage.html(listhtml);$(recentlyViewedItem).hover(function(){$(this).addClass("over")},function(){$(this).removeClass("over")});$(recentlyDelete).on("click",function(e){e.preventDefault();var $id=$(this).data("productid");$.ajax({type:"GET",url:apiUrl+"/api/v2/viewed-products/"+$id+"/delete?count\x3d"+
totalElements+"\x26page\x3d"+(pageNumber-1),dataType:"jsonp",xhrFields:{withCredentials:true},success:function(data){recentlyController._render(data.data)},error:function(data){alert("삭제가 안됐나요? 다시 한번 해보세요.")}})})}this.ui.pageNumber.empty().text(pageNumber);$totalPages.text(totalpages);if($totalPages.text()==1)$btnArea.hide();else $btnArea.show()}else{this.ui.recentlyViewedPage.html('\x3cli class\x3d"no-item"\x3e최근본 상품이\x3cbr/\x3e없습니다.\x3c/li\x3e');$page.hide()}},_movePrev:function(e){e.preventDefault();
var page=parseInt(this.ui.pageNumber.text())-1,$totalPages=$(".total-pages");if(page<1)page=$totalPages.text();recentlyController.renderRecently(page-1)},_moveNext:function(e){e.preventDefault();var page=parseInt(this.ui.pageNumber.text())+1,$totalPages=$(".total-pages");if(page>$totalPages.text())page=1;recentlyController.renderRecently(page-1)},renderRecently:function(page){$.ajax({type:"GET",url:apiUrl+"/api/v2/viewed-products?page\x3d"+page,dataType:"jsonp",xhrFields:{withCredentials:true},success:function(data){recentlyController._render(data.data)},
error:function(data){alert("다시 시도해 주세요.")}})}};return recentlyController});